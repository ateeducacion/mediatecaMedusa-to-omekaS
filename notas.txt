API en localhost:8080:
    key_identity=ui3lRCovebO1g08SCNeogSqDyVMXSXUO
    key_credential=QVUmq4zj28yngVrevGFBI5Mc0OwGlLlV

Pendiente:
    actualizar sites-item_sets
    csv de salida->script para arrancar las task (probar segundo plano?)
    csv de salida (name,url,slug,editor,task_item_set,task_items,task_media,number of itemsets, number of items, number of media)

Prompt for output file:
- The programm must result a json file with this information: 
    - name of channel migrated: as input file
        - url: as input file
        - slug: as input file
        - editor: as input file
        - site id 
        - user id
        - user login: as in input file
        - task created: [
            - task 1: {importer, id}
            - task 2: {importer, id}
            - task 3: {importer, id}
        ]
        - number of itemsets: count of "<wp:term_taxonomy><![CDATA[media-category]]></wp:term_taxonomy>" ocurrencies in xml file
        - number of items: count of <wp:post_parent>0</wp:post_parent> ocurrencies in xml file
        - number of media: count of <item> tag ocurrencies in xml file
- add a param --output-file with the name of the output file
- the output file must be filled after every channel is migrated so that if the programm stopped it would has the information collected in that momment.

Prompt for php script for processing task
- Make a php script for omeka s that takes a json input file and execute the script task.php for each bulkimport task indicated in the input file
    - requirements:
            - the script reads from a input json file with this format:
                [
                    {
                        "name": "Test Channel",
                        "url": "https://www3.gobiernodecanarias.org/medusa/mediateca/pruebas/",
                        "slug": "test-channel",
                        "editor": "test_admin",
                        "site_id": 2,
                        "user_id": 2,
                        "user_login": "test_admin",
                        "tasks_created": [
                        {
                            "importer": "T0. WP categories to Item Set XML",
                            "id": 13
                        },
                        {
                            "importer": "T1. WP posts to Items XML",
                            "id": 14
                        },
                        {
                            "importer": "T2. WP attachments to Media XML",
                            "id": 15
                        }
                        ],
                        "number_of_itemsets": 11,
                        "number_of_items": 76,
                        "number_of_media": 160
                    }
                ]

        - the script return a json file with se same information of the input file but adding the job ids of each bulkimport task but adding a key-value, job_id, in each task_created element 
        - job_id is taken from the output of the script task.php
        - the json output file also has to add the number of item_sets and items of each site, use the php api of omeka s to get the information
        - the script has a param to set as completed the original tasks so that the job cannot be duplicate
        - write the script in scripts directory
    - context: 
        - Modules EasyAdmin and BulkImport installed
        - The script is for a migration of about 800 sites in omeka s, so a detailed information regarding migration of each channel is mandatory
        - this is a example of the task.php command of the module EasyAdmin: php '/var/www/html/modules/EasyAdmin/data/scripts/task.php' --task 'BulkImport\Job\Import' --user-id 1  --args '{"bulk_import_id": 4 }'
        - use omeka s php api to perform operations in omeka s
        - for testing use docker exec -it omeka-s-docker-omekas-1 php run_migration_task.php -- (params)...


NOmbres de centros en mayusculas

Comandos para MIGRACIÓN:
python main.py --config migration_config.json --omeka-url [host]/api --key-identity hX2u9b3JvlztF5fh0sibuJk8evWTe6MV --key-credential YdXCg8Ca0iS77puYEaMo5U8Qj4riPfgV --wp-username admincauce --csv example_channels.csv --output-file pruebas_cauce.json

php run_migration_tasks.php --input-file ../files/preload/pruebas_cauce.json --output-file ./scripts/output.json --delete-tasks --config-site-file default_site_conf.json --default-nav --base-url http://localhost:8888


Preparación server omeka para MIGRACIÓN
1. Directorio scripts en /var/www/html
2. Aegurar que existe /var/www/html/omeka-s (si no existe hacer ln -s /var/www/html /var/www/html/omeka-s)
3. Asegurar que existe /var/www/html/omeka-s/files/preload (si no existe hacer ln -s /var/www/html/omeka-s/files/import /var/www/html/omeka-s/files/preload)


HOJA DE RUTA MIGRACIÓN:
- Configuración inicial
    - Modulos:
        - Advanced Resource Template 	Repositorio oficial Omeka
        - Bulk Import	3.4.59*	Repositorio oficial Omeka *Debe ser esta versión y no la superior porque ha problemas
        - CAS	0.6.3*	https://github.com/ateeducacion/omeka-s-CAS Incluye modificación de cas_logout, solicitada por CAUCE
        - Common		Repositorio oficial Omeka
        - Custom Vocab		Repositorio oficial Omeka
        - Disk Quota		Repositorio oficial Omeka
        - Easy Admin		Repositorio oficial Omeka
        - GlobalLandingPage		Repositorio oficial Omeka
        - Impersonate		Repositorio oficial Omeka
        - Isolated Sites   	Repositorio oficial Omeka
        - ThreeDViewer	1.0.5	Repositorio oficial Omeka
        - HelpAssistant Repositorio oficial Omeka
        - Block Plus    Repositorio oficial Omeka
        - Theme Freedom ATE: https://github.com/ateeducacion/omeka-s-theme-freedom-ate
    - Requisitos del servidor
        - Politicas de ImageMagick:
            <!-- Denegar ZIP -->
            <policy domain="coder" rights="none" pattern="ZIP" />

            <!-- Permitir EPS (comentar o eliminar la política restrictiva) -->
            <!-- <policy domain="coder" rights="none" pattern="EPS" /> -->
            <policy domain="coder" rights="read|write" pattern="EPS" />
            <!-- Permitir MP4 y MOV -->
            <policy domain="coder" rights="read|write" pattern="MP4" />
            <policy domain="coder" rights="read|write" pattern="MOV" />
        - ffmpeg instalado
- Pasos a seguir para migración de Información
    1. Fuera del servidor
        - Preparar csv de traspaso
            name,url,slug,editor
        - Preparar API Keys servidor omeka-s
        - Ejecutar comando:
            setup_venv.p1 (PS)
            source setup_venv.sh (MACOs)
            python main.py --config migration_config.json --omeka-url [host]/api --key-identity hX2u9b3JvlztF5fh0sibuJk8evWTe6MV --key-credential YdXCg8Ca0iS77puYEaMo5U8Qj4riPfgV --wp-username admincauce --csv example_channels.csv --output-file migracion_XXX.json
        - Ejecutar comando de limpieza de ficheros xml
            - limpieza_xml.sh
            - limpieza_xml.ps1
    2. En servidor omeka-s
        - Comprobar trabajos bulkimport
        - Comprobar sitios y usuarios
        - ejecutar script de preparación de servidor
            wget https://github.com/ateeducacion/mediatecaMedusa-to-omekaS/raw/refs/heads/main/scripts/setup_host.sh
            setup_host.sh
        - Pasar a servidor:
            archvivos xml de canales descargados
            archivo migracion_XXX.json
        - en directorio scripts ejecutar
            php run_migration_tasks.php --input-file ../files/preload/pruebas_cauce.json --output-file ./scripts/output.json --delete-tasks --config-site-file default_site_conf.json --default-nav --base-url https://www.gobiernodecanarias.org/medusa/mediateca
            
- Ajuste incial de datos
    - Política de item_sets
        - Sólo se migran los item-sets que contienen algún item.
- Portada
    - Indicar sitios destacados
    - Preparar páginas de condiciones de uso y/o terminos de servicio
- Permisos de usuario:
    - Necesitamos lista de directores para el alta de usuarios
- Preparar correo a centros para informar de cambio de plataforma
    - Dar posibilidad de rescindir el servicio
- Refinar plantilla de recurso creada

- 
    









